---
title: "MP2"
author: "Grace Rade, Carol Milton, Nikki Lin"
date: "2023-04-20"
---

```{r, include=F, warning=F, echo=F}
library(tidyverse)
library(rio)
library(asbio)
library(readr)
library(Stat2Data)
library(car)
library(janitor)
```

```{r, include=F, warning=F, echo=F}
agegb <- import("MP2_agebehaviorFINAL.csv")
agegb[agegb == ''] <- NA
```

<<<<<<< HEAD
```{r, include=F, warning=F, echo=F}
agegb_new <- agegb |>
  clean_names() |>
  # Recode agreement levels into numbers
  filter(!row_number() %in% c(1, 2)) |>
  mutate_at(c("ten_bad_1", "ten_bad_2", "forty_five_bad_1", "forty_five_bad_2","forty_fivegood_1", "forty_fivegood_2", "ten_good_1", "ten_good_2"), 
            ~as.numeric(recode(.,
                   "Strong Disagree" = 1,
                   "Disagree" = 2,
                   "Neither Agree nor Disagree" = 3,
                   "Agree" = 4,
                   "Strong Agree" =5))) |>
  # combining participant responses to the statement: "Sam's behavior is good" into single column "agreement"
  # combining participant responses to the statement: "Sam seems likeable" into single column "opinion"
  gather(condition1, agreement, c("ten_bad_1", "forty_five_bad_1","forty_fivegood_1", "ten_good_1"), factor_key=TRUE) |>
  gather(condition2, opinion, c("ten_bad_2","forty_five_bad_2", "forty_fivegood_2", "ten_good_2")) |>
  unite(condition, condition1, condition2, sep = "", remove=F) |>
  select(q2, q3, q2_2, condition, agreement, opinion) |>
  drop_na("agreement", "opinion") |>
  rename(gender = q2, age = q3, ethnicity = q2_2)

agegb_new$condition[agegb_new$condition == 'ten_bad_1ten_bad_2'] <- '10 Bad'
agegb_new$condition[agegb_new$condition == 'forty_five_bad_1forty_five_bad_2'] <- '45 Bad'
agegb_new$condition[agegb_new$condition == 'ten_good_1ten_good_2'] <- '10 Good'
agegb_new$condition[agegb_new$condition == 'forty_fivegood_1forty_fivegood_2'] <- '45 Good'

agegb_new <- agegb_new |>
  separate(condition, into = c("v_age", "behavior"), remove = FALSE, extra = "merge")
```

```{r}
df <- import("MP2_agebehaviorFINAL.csv")
df$condition <- as.factor(df$condition)
```
=======
>>>>>>> 6de29abcb77ca0fb3c638d84f17bb803d0452180

# Introduction

This project aims to examine how peoples’ opinion of a character in a vignette changes based on the stated age and the described behavior of that character.   
	
Respondents read a vignette about a generic character, who performs the action of baking a cake while being described as a certain age and exhibiting either good or bad behavior. Two groups read vignettes where the character is stated to be a child, while two read vignettes where the character is an adult. Additionally, two groups read vignettes where the character exhibits bad behavior while two read vignettes where the character exhibits good behavior. A total of four respondent groups will read vignettes that contain one combination of age and behavior. All four combinations of age and behavior will be represented in the survey and are randomly assigned to respondents.


## Hypotheses

1. Respondents will exhibit more positive attitudes towards the vignette character of younger age. 

  a. Respondents who have viewed the vignettes featuring Sam as a 10 year old child will give higher levels of agreement to the statement “I like Sam”. 

2. Respondents will exhibit less positive attitudes towards the vignette character who displays negative behavior. 

  a. Respondents who have viewed the vignette featuring Sam leaving a mess in the kitchen and not sharing the cake will give lower levels of agreement to the statement “I like Sam”.

3. Age will have a moderating effect on the attitudes of respondents based on behavior type. 

  a. Respondents will exhibit the most positive attitude towards the vignette character of younger age and positive behavior.


# Methodology

We conducted a two-way randomized survey experiment to investigate our hypotheses. The survey was distributed to Smith College students, and we received a total of [] complete, consenting responses. The two treatment factors, age and behavior, were randomized by a series of vignettes. Each factor combination has [] respondents. The dependent variable is the opinion of the character, Sam,  in the vignette, ascertained via a five-point likert scale agreement to the statement, “Sam seems likable”. A score of 1 represents strong disagreement with the statement, and a score of 5 represents Strong Agreement with the statement. 

Each respondent was shown one of four vignettes, which varied on two aspects: the age of the character in the vignette, and the type of behavior they displayed. All four vignettes featured the character Sam performing the action of baking a cake. Sam is stated to either be ten years old or forty-five years old. Good behavior is cleaning up the kitchen after baking and sharing the cake with friends. Bad behavior is leaving a mess in the kitchen and eating the cake alone. Four vignettes capture the total number of combinations of the two variables.

# Results

## Checking Anova Conditions

We begin with checking the conditions for Anova testing. We know that the response variable, how the much the participant likes Sam, is continuous while the factors, Sam's 'good' or 'bad' actions and Sam's age, are categorical, which satisfies the condition about the types of variables. We then check for constant variance.

### Constant Variance

```{r, warning=F, echo=F}
qplot(x=condition, y=opinion, data=df, ylab="Rating the Liking of Sam",
      xlab='Treatment', geom="boxplot") +
  theme(axis.title = element_text(size = 15))
```
```{r, echo=F}
leveneTest(opinion~condition, data=df)
```

```{r, echo=F}
df |>
  group_by(condition) |>
  summarise(Group_mean=mean(opinion), Sample_size=n(), Standard_dev=sd(opinion))
```

### Normality
```{r, echo=F, warning=F}
ggplot(df, aes(x=opinion, color=condition))+geom_density()
```
There are clear violations of normality for all four groups.

### Transformation

We now check to see if a transformation of the responses can help satisfy the condition of normality. First, we plot the mean and standard deviations for the response variable, liking of Sam, across the treatment groups.

```{r, echo=F, message=F}
summary_stats <- df |>
  group_by(condition) |>
  summarise(mean=log(mean(opinion)), sd=log(sd(opinion)))

ggplot(summary_stats, aes(x=mean, y=sd), ylab="Log(sd)", xlab="Log(mean)") +
  geom_point() +
  geom_smooth(method="lm", se=F)
```

Using the means and standard deviations, we create a linear model and look at the slope.

```{r, echo=F}
lin <- lm(sd~mean, data=summary_stats)
summary(lin)
```

The slope is -0.62 and so 1-slope is 1.62, thus, we can try to see if a reciprocals transformation can help.

```{r, echo=F}
df <- df |>
  mutate(recip_opinion = 1/opinion)
```

```{r, echo=F, warning=F}
ggplot(df, aes(x=recip_opinion, color=condition))+geom_density()
```
The distributions are still not normal so a reciprocals transformation did not help. Therefore, the condition for normality is violated. However, we will continue with Anova testing and then check the robustness of the model with the non-parametric test, the Kruskal Wallis test.

## Anova Testing
```{r, echo=F}
# will create anova model called liking.aov
```


## Kruskal Wallis Test

## Checking Residuals

We want to check the residuals to further evaluate our model.

```{r, echo=F, warning=F}
# resid <-  resid(liking.aov)
# 
# Model <- data.frame(Fitted = fitted(liking.aov), 
#                     Residuals = resid(liking.aov),
#                     Treatment = df$condition,
#                     Observed=df$opinion)
```

```{r, echo=F, warning=F}
# ggplot(Model, aes(x=Treatment, y=Residuals)) + geom_point()
```



```{r, echo=F, warning=F}
# ggplot(Model, aes(x=Residuals, color=Treatment))+geom_density()
```

# Conclusion



