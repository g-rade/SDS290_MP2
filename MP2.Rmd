---
title: "MP2"
author: "Grace Rade, Carol Milton, Nikki Lin"
date: "2023-04-20"
---
```{r, include=F, warning=F, echo=F}
library(tidyverse)
library(rio)
library(asbio)
library(readr)
library(Stat2Data)
library(car)
```

```{r, include=F, warning=F, echo=F}
df <- import("MP2_agebehaviorFINAL.csv")
df$condition <- as.factor(df$condition)
df$v_age <- as.factor(df$v_age)
df$behavior <- as.factor(df$behavior)
```


# Introduction

This project aims to examine how peoples’ opinion of a character in a vignette changes based on the stated age and the described behavior of that character.   
	
Respondents read a vignette about a generic character, who performs the action of baking a cake while being described as a certain age and exhibiting either good or bad behavior. Two groups read vignettes where the character is stated to be a child, while two read vignettes where the character is an adult. Additionally, two groups read vignettes where the character exhibits bad behavior while two read vignettes where the character exhibits good behavior. A total of four respondent groups will read vignettes that contain one combination of age and behavior. All four combinations of age and behavior will be represented in the survey and are randomly assigned to respondents.


## Hypotheses

1. Respondents will exhibit more positive attitudes towards the vignette character of younger age. 

  a. Respondents who have viewed the vignettes featuring Sam as a 10 year old child will give higher levels of agreement to the statement “I like Sam”. 

2. Respondents will exhibit less positive attitudes towards the vignette character who displays negative behavior. 

  a. Respondents who have viewed the vignette featuring Sam leaving a mess in the kitchen and not sharing the cake will give lower levels of agreement to the statement “I like Sam”.

3. Age will have a moderating effect on the attitudes of respondents based on behavior type. 

  a. Respondents will exhibit the most positive attitude towards the vignette character of younger age and positive behavior.


# Methodology

We conducted a two-way randomized survey experiment to investigate our hypotheses. The survey was distributed to Smith College students, and we received a total of 58 complete, consenting responses. The two treatment factors, age and behavior, were randomized by a series of vignettes. Each factor has a similar number of resondents. 10 Good has 13 responses, 45 Bad has 15 responses, and 10 Bad and 45 Good each have 14 responses. The dependent variable is the opinion of the character, Sam,  in the vignette, ascertained via a five-point likert scale agreement to the statement, “Sam seems likable”. A score of 1 represents strong disagreement with the statement, and a score of 5 represents Strong Agreement with the statement. 

Each respondent was shown one of four vignettes, which varied on two aspects: the age of the character in the vignette, and the type of behavior they displayed. All four vignettes featured the character Sam performing the action of baking a cake. Sam is stated to either be ten years old or forty-five years old. Good behavior is cleaning up the kitchen after baking and sharing the cake with friends. Bad behavior is leaving a mess in the kitchen and eating the cake alone. Four vignettes capture the total number of combinations of the two variables.

# Results

## Checking Anova Conditions

We begin with checking the conditions for Anova testing. We know that the response variable, how the much the participant likes Sam, is continuous while the factors, Sam's 'good' or 'bad' actions and Sam's age, are categorical, which satisfies the condition about the types of variables. We then check for constant variance.

### Constant Variance

```{r, warning=F, echo=F}
qplot(x=condition, y=opinion, data=df, ylab="Ban Football in High School",
      xlab='Treatment', geom="boxplot") +
  theme(axis.title = element_text(size = 15))
```

```{r, echo=F}
leveneTest(opinion~condition, data=df)
```

```{r, echo=F}
df |>
  group_by(condition) |>
  summarise(Group_mean=mean(opinion), Sample_size=n(), Standard_dev=sd(opinion))
```

The box-plot and the table of  standard deviations show that there is a slight violation of the constant variance assumption. However, the Levene's Test idicates that the variance across groups is not statistically different, so we will proceed. 

### Normality
```{r, echo=F, warning=F}
ggplot(df, aes(x=opinion, color=condition))+geom_density()
```
There are clear violations of normality for all four groups.

### Transformation

We now check to see if a transformation of the responses can help satisfy the condition of normality. First, we plot the mean and standard deviations for the response variable, liking of Sam, across the treatment groups.

```{r, echo=F, message=F}
summary_stats <- df |>
  group_by(condition) |>
  summarise(mean=log(mean(opinion)), sd=log(sd(opinion)))
ggplot(summary_stats, aes(x=mean, y=sd), ylab="Log(sd)", xlab="Log(mean)") +
  geom_point() +
  geom_smooth(method="lm", se=F)
```

Using the means and standard deviations, we create a linear model and look at the slope.

```{r, echo=F}
lin <- lm(sd~mean, data=summary_stats)
summary(lin)
```

The slope is -0.62 and so 1-slope is 1.62, thus, we can try to see if a reciprocals transformation can help.

```{r, echo=F}
df <- df |>
  mutate(recip_opinion = 1/opinion)
```

```{r, echo=F, warning=F}
ggplot(df, aes(x=recip_opinion, color=condition))+geom_density()
```

The distributions are still not normal so a reciprocals transformation did not help. Therefore, the condition for normality is violated. However, we will continue with Anova testing and then check the robustness of the model with the non-parametric test, the Kruskal Wallis test.

## Anova Testing

First, we will assess the data for the appearance of interaction between our dependent variables. 

```{r}
TukeyNonaddPlot(opinion~as.factor(v_age)+behavior, data = df)
interaction.plot(df$v_age, df$behavior, df$opinion, xlab = "Vignette Age", ylab = "Mean Opinion of Sam", trace.label = "Vignette Behavior")
```

The Tukey plot has a nonzero slope, which indicates that there is evidence of non-additivity. However, the interaction plot shows that the lines for Good and Bad behavior do not intersect but have slopes of opposite signs. We will fit both an additive and interaction model.

```{r, echo=F}
liking_aov_add <- aov(opinion~v_age+behavior, data = df)
summary(liking_aov)

liking_aov_inter <- aov(opinion~v_age*behavior, data = df)
summary(liking_aov_inter)
```


In both the additive and interactive models, we see that the mean opinions of the vignette character are different across the levels of the behavior variable (Good/Bad). The F-value is large and the p-value is smaller than 0.05, which provides sufficient evidence to reject the null hypothesis. From this, we can conclude, that the behavior described in the vignette influences the opinion of the vignette character of Smith College students. We do not have sufficient evidence to conclude that the described age of the vignette character has any affect on Smithie's mean opinion of Sam. There is also not sufficent evidence that the vignette character age variable interacts with the behavior variable.

## Kruskal Wallis Test

Given the violation of the normality assumption, we will vertify our results with a non-parametric test. Since we have more than two groups in our analysis, we will use a Kruskal-Wallis test. 

```{r}
kruskal.test(opinion~v_age+behavior, data = df)
```

## Regression

## Checking Residuals

We want to check the residuals to further evaluate our model.

```{r, echo=F, warning=F}
# resid <-  resid(liking.aov)
# 
# Model <- data.frame(Fitted = fitted(liking.aov), 
#                     Residuals = resid(liking.aov),
#                     Treatment = df$condition,
#                     Observed=df$opinion)
```

```{r, echo=F, warning=F}
# ggplot(Model, aes(x=Treatment, y=Residuals)) + geom_point()
```



```{r, echo=F, warning=F}
# ggplot(Model, aes(x=Residuals, color=Treatment))+geom_density()
```

# Conclusion

