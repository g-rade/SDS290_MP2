---
title: "MP2"
author: "Grace Rade, Carol Milton, Nikki Lin"
date: "2023-04-20"
output: pdf_document
---
```{r, warning = F, message = F, echo = F}
library(tidyverse)
library(rio)
library(asbio)
library(readr)
library(Stat2Data)
library(car)
```

```{r, warning = F, message = F, echo = F}
df <- import("MP2_agebehaviorFINAL.csv")
df$condition <- as.factor(df$condition)
df$v_age <- as.factor(df$v_age)
df$behavior <- as.factor(df$behavior)
```


# Introduction

This project aims to examine how peoples’ opinion of a character in a vignette changes based on the stated age and the described behavior of that character.   
	
Respondents read a vignette about a generic character, who performs the action of baking a cake while being described as a certain age and exhibiting either good or bad behavior. Two groups read vignettes where the character is stated to be a child, while two read vignettes where the character is an adult. Additionally, two groups read vignettes where the character exhibits bad behavior while two read vignettes where the character exhibits good behavior. A total of four respondent groups will read vignettes that contain one combination of age and behavior. All four combinations of age and behavior will be represented in the survey and are randomly assigned to respondents.


## Hypotheses

1. Respondents will exhibit more positive attitudes towards the vignette character of younger age. 

  a. Respondents who have viewed the vignettes featuring Sam as a 10 year old child will give higher levels of agreement to the statement “I like Sam”. 

2. Respondents will exhibit less positive attitudes towards the vignette character who displays negative behavior. 

  a. Respondents who have viewed the vignette featuring Sam leaving a mess in the kitchen and not sharing the cake will give lower levels of agreement to the statement “I like Sam”.

3. Age will have a moderating effect on the attitudes of respondents based on behavior type. 

  a. Respondents will exhibit the most positive attitude towards the vignette character of younger age and positive behavior.


# Methodology

We conducted a two-way randomized survey experiment to investigate our hypotheses. The survey was distributed to Smith College students, and we received a total of 58 complete, consenting responses. The two treatment factors, age and behavior, were randomized by a series of vignettes. Each factor has a similar number of resondents. 10 Good has 13 responses, 45 Bad has 15 responses, and 10 Bad and 45 Good each have 14 responses. The dependent variable is the opinion of the character, Sam,  in the vignette, ascertained via a five-point likert scale agreement to the statement, “Sam seems likable”. A score of 1 represents strong disagreement with the statement, and a score of 5 represents Strong Agreement with the statement. 

Each respondent was shown one of four vignettes, which varied on two aspects: the age of the character in the vignette, and the type of behavior they displayed. All four vignettes featured the character Sam performing the action of baking a cake. Sam is stated to either be ten years old or forty-five years old. Good behavior is cleaning up the kitchen after baking and sharing the cake with friends. Bad behavior is leaving a mess in the kitchen and eating the cake alone. Four vignettes capture the total number of combinations of the two variables.

# Results

## Checking Anova Conditions

We begin with checking the conditions for Anova testing. We know that the response variable, how the much the participant likes Sam, is continuous while the factors, Sam's 'good' or 'bad' actions and Sam's age, are categorical, which satisfies the condition about the types of variables. We then check for constant variance.

### Constant Variance

```{r, warning = F, message = F, echo = F}
qplot(x=condition, y=opinion, data=df, ylab="Ban Football in High School",
      xlab='Treatment', geom="boxplot") +
  theme(axis.title = element_text(size = 15))
```

```{r, warning = F, message = F, echo = F}
leveneTest(opinion~condition, data=df)
```

```{r, warning = F, message = F, echo = F}
df |>
  group_by(condition) |>
  summarise(Group_mean=mean(opinion), Sample_size=n(), Standard_dev=sd(opinion))
```

The box-plot and the table of  standard deviations show that there is a slight violation of the constant variance assumption. However, the Levene's Test idicates that the variance across groups is not statistically different, so we will proceed. 

### Normality
```{r, warning = F, message = F, echo = F}
ggplot(df, aes(x=opinion, color=condition))+geom_density()
```
There are clear violations of normality for all four groups.

### Transformation

We now check to see if a transformation of the responses can help satisfy the condition of normality. First, we plot the mean and standard deviations for the response variable, liking of Sam, across the treatment groups.

```{r, warning = F, message = F, echo = F}
summary_stats <- df |>
  group_by(condition) |>
  summarise(mean=log(mean(opinion)), sd=log(sd(opinion)))
ggplot(summary_stats, aes(x=mean, y=sd), ylab="Log(sd)", xlab="Log(mean)") +
  geom_point() +
  geom_smooth(method="lm", se=F)
```

Using the means and standard deviations, we create a linear model and look at the slope.

```{r, warning = F, message = F, echo = F}
lin <- lm(sd~mean, data=summary_stats)
summary(lin)
```

The slope is -0.62 and so 1-slope is 1.62, thus, we can try to see if a reciprocals transformation can help.

```{r, warning = F, message = F, echo = F}
df <- df |>
  mutate(recip_opinion = 1/opinion)
```

```{r,warning = F, message = F, echo = F}
ggplot(df, aes(x=recip_opinion, color=condition))+geom_density()
```

The distributions are still not normal so a reciprocals transformation did not help. Therefore, the condition for normality is violated. However, we will continue with Anova testing and then check the robustness of the model with the non-parametric test, the Kruskal Wallis test.

## Anova Testing

First, we will assess the data for the appearance of interaction between our dependent variables. 

```{r, warning = F, message = F, echo = F}
TukeyNonaddPlot(opinion~as.factor(v_age)+behavior, data = df)
interaction.plot(df$v_age, df$behavior, df$opinion, xlab = "Vignette Age", ylab = "Mean Opinion of Sam", trace.label = "Vignette Behavior")
```

The Tukey plot has a nonzero slope, which indicates that there is evidence of non-additivity. However, the interaction plot shows that the lines for Good and Bad behavior do not intersect but have slopes of opposite signs. We will fit both an additive and interaction model.

```{r, warning = F, message = F, echo = F}
liking_aov_add <- aov(opinion~v_age+behavior, data = df)
summary(liking_aov_add)

liking_aov_inter <- aov(opinion~v_age*behavior, data = df)
summary(liking_aov_inter)
```


In both the additive and interactive models, we see that the mean opinions of the vignette character are different across the levels of the behavior variable (Good/Bad). The F-value is large and the p-value is smaller than 0.05, which provides sufficient evidence to reject the null hypothesis. From this, we can conclude, that the behavior described in the vignette influences the opinion of the vignette character of Smith College students. We do not have sufficient evidence to conclude that the described age of the vignette character has any affect on Smithie's mean opinion of Sam. There is also not sufficent evidence that the vignette character age variable interacts with the behavior variable.

### Kruskal Wallis Test

Given the violation of the normality assumption, we will verify our results with a non-parametric test. Since we have more than two groups in our analysis, we will use a Kruskal-Wallis test. To do so, we will conduct separate tests for each of our explanatory variables.

```{r, warning = F, message = F, echo = F}
kruskal.test(opinion~behavior, data = df)
kruskal.test(opinion~v_age, data = df)
```

We see that the behavior variable once again is signficant while the vignette age variable is not. Our results from the ANOVA are confirmed using non-parametric methods. 

### Pairwise Comparisons

To test our pairwise comparisons, we will use both a TukeyHSD test and a Bonferonni Adjustment. The Tukey test will condict pairwise comparisons for both of our explanatory variables, while the Bonferroni test will conduct pairwiase comparisons for each of the four groups using the condition variable, which indicates which combination of age and behavior was described in the vignette for each respondent. 

```{r, warning = F, message = F, echo = F}
TukeyHSD(liking_aov_add)
bonfCI(df$opinion, df$condition, conf.level = 0.95)
```

The Tukey HSD test shows that the behavior groups are different from one another, while the age groups are not. This supports our earlier conclusions that behavior is a signficiant predictor of mean opinion of the vignette character, but not stated character age. 

The Bonferroni Adjustment also supports this conclusion. We see that for each of teh four significant pairwise comparisons, the behavior is different (i.e. Good vs. Bad comparison). For two of the signficant pairwise comparisons, the age of the character varies, but does not for the other two. This also supports the conclusion that the described type of behavior in the vignette influences the mean opinion of Sam. 


## Post-Modeling Condition Checks

We want to check the residuals to further evaluate our model.

```{r, echo=F, warning=F, messafe = F}
resid <-  resid(liking_aov_add)

Model <- data.frame(Fitted = fitted(liking_aov_add), 
                     Residuals = resid(liking_aov_add),
                     Treatment = df$condition,
                     Observed=df$opinion)
```

```{r, echo=F, warning=F, message = F}
plot(liking_aov_add, which = 1)
plot(liking_aov_add, which = 2)
```

The Fitted vs. Residuals plot shows that the residuals for the additive ANOVA model are reasonably symmetrically distributed. However, the normality condition is very clearly violated as the residuals do not fall along a line. We also see that the residuals are not symmetrical from the density plot. 

```{r, echo=F, warning=F, message = F}
ggplot(Model, aes(x=Residuals, color=Treatment))+geom_density()
```

### Effect Sizes

```{r, warning = F, message = F, echo = F}
mse <- 0.91

tengb <- -1.72527/0.91
tenbffb <- 0.1619/0.91
tengffb <- 1.88718/0.91
tenbffg <- -2.07143/0.91
tengffg <- -0.34615/0.91
ffbffg <- -2.23333/0.91

list("10 Bad vs. 10 Good" = tengb, "10 Bad vs. 45 Bad" = tenbffb, "10 Good vs. 45 Bad "= tengffb, "10 Bad vs. 45 Good" = tenbffg, "10 Good vs. 45 Good" = tengffg, "45 Bad vs. 45 Good" = ffbffg) 
```

The groups that have large effects are the groups that vary by behavior type. Additionally, some groups with large effects also vary by age, but not all. The groups that do not vary by behavior type do not have large effects. 10 Bad vs. 45 Bad has a trivial effect and 10 Good vs. 45 Good has a small effect. 

# Conclusion

